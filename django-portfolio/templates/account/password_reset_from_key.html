{% extends "shop/base.html" %}
{% load i18n form_tags static %}

{% block title %}Change password - My Shoppings{% endblock %}

{% block content %}
<article class="auth-card" role="main" aria-labelledby="change-pass-title">
  <h1 id="change-pass-title" class="auth-title">Change password</h1>
  <p class="auth-sub">Choose a strong password. Don't reuse a password you use elsewhere.</p>

  {% include "account/messages.html" %}

  {% if form.non_field_errors %}
    <div class="alert alert-error" role="alert" style="margin-bottom:12px;">
      {{ form.non_field_errors|join:" " }}
    </div>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}

    {% for field in form.visible_fields %}
      <div class="form-row">

        <label class="form-label" for="{{ field.id_for_label }}">
          {{ field.label }}
        </label>

        {% if field.field.widget.input_type == "password" %}
          <!-- Password field (same as login page) -->
          <div style="
            display:flex;
            align-items:center;
            border:1px solid #ddd;
            border-radius:6px;
            width:100%;
          ">
            <input
              type="password"
              id="{{ field.id_for_label }}"
              name="{{ field.html_name }}"
              class="input-full"
              style="
                flex:1;
                border:none;
                padding:10px;
                outline:none;
              "
              {% if field.value %}value="{{ field.value }}"{% endif %}
            >

            <button
              type="button"
              class="toggle-password"
              data-target="{{ field.id_for_label }}"
              style="
                background:none;
                border:none;
                padding:0 12px;
                font-size:13px;
                font-weight:600;
                color:#007BFF;
                cursor:pointer;
              "
            >
              SHOW
            </button>
          </div>
        {% else %}
          {{ field|add_class:"input-full" }}
        {% endif %}

        {% if field.help_text %}
          <small style="
            display:block;
            color:var(--muted);
            margin-top:6px;
            font-size:14px;
            line-height:1.6;
          ">
            {{ field.help_text|safe }}
          </small>
        {% endif %}

        {% if field.errors %}
          <div class="alert alert-error" role="alert" style="margin-top:8px;">
            {{ field.errors|join:", " }}
          </div>
        {% endif %}

      </div>
    {% endfor %}

    <div class="form-row" style="margin-top:10px;">
      <button type="submit" class="btn" style="width:100%;">
        Change password
      </button>
    </div>

    <div style="text-align:center;margin-top:14px;color:var(--muted);">
      <a href="{% url 'account_login' %}">Back to sign in</a>
    </div>
  </form>
</article>

<!-- SHOW / HIDE PASSWORD SCRIPT -->
<script>
  document.querySelectorAll(".toggle-password").forEach(btn => {
    btn.addEventListener("click", () => {
      const input = document.getElementById(btn.dataset.target);
      if (!input) return;

      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "HIDE";
      } else {
        input.type = "password";
        btn.textContent = "SHOW";
      }
    });
  });
</script>
{% endblock %}
