{% extends "shop/base.html" %}
{% load socialaccount %}
{% load static %}
{% load i18n %}

{% block title %}Signup - My Shoppings{% endblock %}

{% block content %}
<div class="signup-card" style="max-width:560px;margin:48px auto;padding:30px;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(3,35,70,0.06);">
  <h2 style="margin-top:0;text-align:center;font-size:20px;font-weight:700;color:#222;">Create an account</h2>

  {% if form.non_field_errors %}
    <div style="background:#fff1f0;color:#9b1c18;padding:10px;border-radius:8px;margin:12px 0;">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  {% if otp_error %}
    <div style="background:#fff1f0;color:#9b1c18;padding:10px;border-radius:8px;margin:12px 0;">
      {{ otp_error }}
    </div>
  {% endif %}

  <div style="display:flex;flex-direction:column;gap:12px;margin:18px 0;">
    <a href="{% provider_login_url 'google' process='signup' %}"
       style="display:flex;align-items:center;justify-content:center;gap:12px;padding:12px;border-radius:10px;border:1px solid #e6edf8;text-decoration:none;font-weight:700;background:#fff;">
      <!-- Inline Google "G" icon -->
      <svg width="20" height="20" viewBox="0 0 533.5 544.3" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path fill="#4285F4" d="M533.5 278.4c0-18.5-1.5-36.3-4.3-53.5H272v101.3h147.1c-6.3 34.1-25.1 62.9-53.3 82.2l86.1 67.3c50.2-46.3 81.6-114.3 81.6-197.3z"/>
        <path fill="#34A853" d="M272 544.3c72.6 0 133.6-24 178.1-65.1l-86.1-67.3c-23.9 16.1-54.6 25.6-92 25.6-70.7 0-130.5-47.8-152-111.9L36.2 347.2C82.8 472 170.5 544.3 272 544.3z"/>
        <path fill="#FBBC05" d="M120 325.6c-10.6-31.7-10.6-65.9 0-97.6L36.2 180.7C12 230.6 0 283.8 0 338.1c0 54.3 12 107.5 36.2 157.4L120 325.6z"/>
        <path fill="#EA4335" d="M272 110.7c39 0 74 13.4 101.6 39.6l76.1-76.1C405.6 24 344.6 0 272 0 170.5 0 82.8 72.3 36.2 180.7l103.9 47.1C141.5 158.5 201.3 110.7 272 110.7z"/>
      </svg>
      <span style="color:#202124;font-weight:700;">Sign up with Google</span>
    </a>
  </div>

  <div style="text-align:center;color:#6b7280;margin-bottom:18px;">
    <small>Or sign up with your email (we'll send an OTP to verify)</small>
  </div>

  <form method="post" novalidate>
    {% csrf_token %}

    <div style="margin-bottom:14px;">
      <label style="display:block;font-weight:600;margin-bottom:6px;color:#374151;">Username</label>
      {{ form.username }}
      {% if form.username.errors %}
        <div style="color:#9b1c18;margin-top:8px;">{{ form.username.errors|join:", " }}</div>
      {% endif %}
    </div>

    <div style="margin-bottom:14px;">
      <label style="display:block;font-weight:600;margin-bottom:6px;color:#374151;">Email</label>
      {{ form.email }}
      {% if form.email.errors %}
        <div style="color:#9b1c18;margin-top:8px;">{{ form.email.errors|join:", " }}</div>
      {% endif %}
    </div>

    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <div style="flex:1;min-width:200px;margin-bottom:14px;">
        <label style="display:block;font-weight:600;margin-bottom:6px;color:#374151;">Password</label>
        {{ form.password1 }}
        {% if form.password1.errors %}
          <div style="color:#9b1c18;margin-top:8px;">{{ form.password1.errors|join:", " }}</div>
        {% endif %}
      </div>

      <div style="flex:1;min-width:200px;margin-bottom:14px;">
        <label style="display:block;font-weight:600;margin-bottom:6px;color:#374151;">Confirm Password</label>
        {{ form.password2 }}
        {% if form.password2.errors %}
          <div style="color:#9b1c18;margin-top:8px;">{{ form.password2.errors|join:", " }}</div>
        {% endif %}
      </div>
    </div>

    <div style="margin-bottom:14px;">
      <label style="display:block;font-weight:600;margin-bottom:6px;color:#374151;">Mobile / Phone</label>
      {{ form.phone }}
      {% if form.phone.errors %}
        <div style="color:#9b1c18;margin-top:8px;">{{ form.phone.errors|join:", " }}</div>
      {% endif %}
    </div>

    {% if show_otp %}
      <div style="margin-top:12px;padding:12px;background:#f8fbff;border-radius:8px;border:1px solid #e6edf8;">
        <p style="margin:0 0 8px;">An OTP has been sent to <strong>{{ otp_sent_to }}</strong>. Enter it below to complete signup.</p>
        <label style="display:block;font-weight:600;margin-bottom:6px;color:#374151;">OTP</label>
        <input type="text" name="otp" maxlength="6" style="width:100%;padding:10px 12px;border:1px solid #e6edf8;border-radius:8px;margin-bottom:8px;">
        <input type="hidden" name="otp_verify" value="1">
        <button type="submit" style="width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,#0b63d6,#2373ff);color:white;font-weight:700;margin-top:6px;">
          Verify OTP & Signup
        </button>
      </div>
      <p style="margin-top:10px;color:#6b7280;font-size:13px;text-align:center;">Didn't receive? resubmit the signup form to request a new OTP.</p>
    {% else %}
      <button type="submit"
              style="width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,#0b63d6,#2373ff);color:white;font-weight:700;margin-top:6px;">
        Signup (Send OTP)
      </button>
    {% endif %}
  </form>

  <p style="text-align:center;margin-top:14px;color:#6b7280;">Already have an account? <a href="{% url 'shop:login' %}" style="color:#2563eb;">Login</a></p>
</div>

<style>
  /* target inputs inside the signup card so we don't need add_class */
  .signup-card input, .signup-card select, .signup-card textarea {
    width:100%;
    padding:10px 12px;
    border:1px solid #e6edf8;
    border-radius:8px;
    background:#fff;
    box-sizing:border-box;
  }

  @media (max-width:600px){
    .signup-card { margin:18px 16px; padding:20px; }
  }
</style>
{% endblock %}
