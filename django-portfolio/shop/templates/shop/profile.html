{% extends "shop/base.html" %}
{% load static %}

{% block title %}Profile - My Shoppings{% endblock %}

{% block content %}
<style>
  /* Desktop-first layout: two-column card layout aligned with base.html widths */
  .profile-wrap {
    max-width: 1100px;
    margin: 40px auto;
    padding: 18px;
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 22px;
  }

  /* MOBILE VIEW — apply only for small phones/tablets */
  @media (max-width: 600px) {
    .profile-wrap {
      grid-template-columns: 1fr;
      padding: 10px;
      margin: 16px auto;
    }

    .avatar .img { width:72px; height:72px; font-size:24px; }
    .profile-left .card, .profile-right .card { padding:14px; }
  }

  .card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 28px rgba(11, 35, 77, 0.06);
    padding: 20px;
  }

  .avatar {
    display: flex;
    gap: 14px;
    align-items: center;
  }

  .avatar .img {
    width: 84px;
    height: 84px;
    border-radius: 50%;
    background: linear-gradient(135deg, #e9f2ff, #fff);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #0b63d6;
    font-size: 28px;
    overflow: hidden;
    border: 3px solid #f0f7ff;
    box-shadow: 0 6px 18px rgba(11, 99, 214, 0.06);
  }

  .meta h3 { margin: 0 0 6px 0; font-size: 18px; }
  .meta small { color: #6b7280; }

  .quick-links {
    display:flex;
    flex-direction: column;
    gap:10px;
    margin-top:10px;
  }

  .quick-links a {
    text-decoration:none;
    padding:10px;
    border-radius:10px;
    background:#fbfdff;
    border:1px solid #e8f1ff;
    font-weight:600;
    color:#0b63d6;
  }

  .profile-form-row {
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:12px;
    flex-wrap:wrap;
  }

  .profile-form-row label {
    min-width:110px;
    font-weight:700;
    color:#374151;
  }

  input[type="text"], input[type="email"], input[type="tel"], textarea {
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #e6eefc;
    background:#fbfcff;
    font-size:14px;
  }

  textarea { min-height:100px; }

  .actions {
    display:flex;
    gap:10px;
    margin-top:12px;
  }

  .btn-primary {
    padding:10px 14px;
    border-radius:10px;
    background: linear-gradient(90deg,#007bff,#00c6ff);
    color:white;
    border:none;
    cursor:pointer;
    font-weight:700;
  }

  .small { font-size:13px; color:#6b7280; }
  .divider { height:1px;background:#f1f6ff;margin:12px 0; }

</style>

<div class="profile-wrap">

  <!-- LEFT CARD: summary & quick links -->
  <div class="profile-left">
    <div class="card">
      <div class="avatar">
        <!-- Avatar: first letter of username -->
        <div class="img" aria-hidden="true">
          {% if request.user.first_name %}
            {{ request.user.first_name|slice:":1"|upper }}
          {% else %}
            {{ request.user.username|slice:":1"|upper }}
          {% endif %}
        </div>

        <div class="meta">
          <h3>{{ request.user.get_username }}</h3>
          <small>Member since {{ request.user.date_joined|date:"M Y" }}</small>
        </div>
      </div>

      <div class="divider"></div>

      <div style="font-weight:700">Email</div>
      <div class="small" style="margin-bottom:8px;">{{ request.user.email }}</div>

      <div style="font-weight:700">Phone</div>
      <div class="small">{{ profile.phone|default:"Not added" }}</div>

      <div class="quick-links" style="margin-top:14px;">
        <a href="{% url 'shop:my_orders' %}">Orders →</a>
        <a href="{% url 'shop:checkout' %}?buy=0">Saved Addresses →</a>
        <a href="{% url 'shop:product_list' %}">Wishlist →</a>
        <a href="{% url 'shop:logout' %}" style="color:#b00020;">Logout</a>
      </div>
    </div>
  </div>

  <!-- RIGHT: editable profile form -->
  <div class="profile-right">
    <div class="card">
      <h2 style="margin:0 0 10px 0;">Your Profile</h2>
      <div class="small" style="margin-bottom:12px;">Manage your personal information</div>

      <form method="post" novalidate>
        {% csrf_token %}

        <!-- Editable Username -->
        <div class="profile-form-row">
          <label for="id_username">Username</label>
          <div class="value">
            <input id="id_username" type="text" name="username" value="{{ request.user.username }}">
          </div>
        </div>

        <!-- NON Editable Email -->
        <div class="profile-form-row">
          <label>Email</label>
          <div class="value">
            <input type="email" value="{{ request.user.email }}" readonly>
          </div>
        </div>

        <!-- NON Editable Phone -->
        <div class="profile-form-row">
          <label>Phone</label>
          <div class="value">
            <input type="text" value="{{ profile.phone|default:'Not added' }}" readonly>
          </div>
        </div>

        <!-- Editable Address -->
        <div class="profile-form-row" style="align-items:flex-start;">
          <label for="id_address">Address</label>
          <div class="value">
            <textarea id="id_address" name="address" placeholder="Add delivery address...">{% if profile.address %}{{ profile.address }}{% endif %}</textarea>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary">Save changes</button>
        </div>

        <div style="margin-top:10px;" class="small">
          Last updated: {{ request.user.last_login|date:"d M Y H:i" }}
        </div>
      </form>
    </div>
  </div>

</div>
{% endblock %}
